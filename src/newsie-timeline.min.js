function parseTime(a){return a.split(":")}function getCoords(){$.each(dates,function(a,b){dateCoords[a]=coord(Math.min.apply(Math,dates),Math.max.apply(Math,dates),b)})}function collision(a,b){var c=a.offset().left,d=a.offset().top,e=a.outerHeight(!0),f=a.outerWidth(!0),g=d+e,h=c+f,i=b.offset().left,j=b.offset().top,k=b.outerHeight(!0),l=b.outerWidth(!0),m=j+k,n=i+l;return j>g||d>m||i>h||c>n?!1:!0}function getTime(a){var b=0==a.getHours()&&0==a.getMinutes()&&0==a.getSeconds()?"":a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes();return b}function calculateScrollVals(){$(".newsie-timeline-item").each(function(a){scrollVals[a]=$("#newsie-line").hasClass("stickit")?Math.floor($("#newsie-timeline-item-"+a).offset().top-80):Math.floor($("#newsie-timeline-item-"+a).offset().top-162)})}function populateDivs(){$.each(json.date,function(a,b){var c=new Date;c=b,dates[a]=c,$("#newsie-content").append($("<div>").attr({"class":"newsie-timeline-item",id:"newsie-timeline-item-"+a}).append($("<a>").attr({"class":"newsie-timeline-item-date",id:"newsie-timeline-item-date-"+a,name:"#newsie-timeline-item-"+a}).html("<h3>"+month[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear()+" "+getTime(c)+"</h3>")).append($("<div>").attr({"class":"newsie-timeline-item-story-container",id:"newsie-timeline-item-story-container-"+a}).append($("<div>").attr({"class":"newsie-timeline-item-story",id:"newsie-timeline-item-story-"+a}).html("<h3>"+(null==json.title[a]?"":json.title[a])+"</h3>"+"<p>"+(null==json.content[a]?"":json.content[a])+"</p>")))),null!=json.mediaURL[a]&&$("#newsie-timeline-item-story-container-"+a).prepend($("<div>").attr({"class":"newsie-timeline-item-image",id:"newsie-timeline-item-image-"+a}).html("<img src="+json.mediaURL[a]+">")),null!=json.mediaCredit[a]&&$("#newsie-timeline-item-image-"+a).append($("<p class='newsie-media-credit'>").html(json.mediaCredit[a]))})}function drawTimeline(){$.each(dateCoords,function(a,b){$("#timeline-events").append($("<li>").attr({"class":"newsie-timeline-event-dot",id:"newsie-timeline-event-dot-"+a}).css({position:"absolute",left:100*b+"%"}).click(function(){calculateScrollVals(),$("html, body").animate({scrollTop:scrollVals[a]},500),$("#newsie-timeline-item-label-"+a).addClass("newsie-timeline-event-dot-selected")}).mouseover(function(){$(this).addClass("newsie-timeline-event-dot-active"),$(".newsie-timeline-label").each(function(){"first-newsie-timeline-label"!=$(this).attr("id")&&"last-newsie-timeline-label"!=$(this).attr("id")&&"newsie-timeline-labels"!=$(this).attr("id")&&$(this).css("visibility","hidden")}),$("#newsie-timeline-label-"+a).css("visibility","visible")}).mouseleave(function(){$(this).removeClass("newsie-timeline-event-dot-active"),$("#newsie-timeline-event-dot-"+a).hasClass("newsie-timeline-event-dot-selected")||$("#newsie-timeline-label-"+a).css("visibility","hidden"),$("#first-newsie-timeline-label").css("visibility","visible"),$("#last-newsie-timeline-label").css("visibility","visible"),$(".newsie-timeline-event-dot").each(function(a){$("#newsie-timeline-event-dot-"+a).hasClass("newsie-timeline-event-dot-selected")&&$("#newsie-timeline-label-"+a).css("visibility","visible")})})),$("#newsie-back-button").unbind("click").click(function(){curPos>0&&$("html,body").animate({scrollTop:scrollVals[curPos-1]},250)}),$("#newsie-forward-button").unbind("click").click(function(){curPos<$(".newsie-timeline-event-dot").length-1&&$("html,body").animate({scrollTop:scrollVals[curPos+1]},250)}),$("#newsie-timeline-labels").append($("<li>").attr({"class":"newsie-timeline-label",id:"newsie-timeline-label-"+a}).text(month[dates[a].getMonth()]+" "+dates[a].getDate()+", "+dates[a].getFullYear()+" "+getTime(dates[a])).css({visibility:"hidden",position:"absolute",left:100*dateCoords[a]+"%"}))})}function currentView(){calculateScrollVals();var a=Math.floor($(document).scrollTop()),b=5;$.each(scrollVals,function(c){c+1<scrollVals.length?a>=scrollVals[c]-b&&a<scrollVals[c+1]-b?(curPos=c,$("#newsie-timeline-event-dot-"+c).addClass("newsie-timeline-event-dot-selected"),$("#newsie-timeline-event-dot-"+c).css("z-index","10"),$("#newsie-timeline-label-"+c).css("visibility","visible")):($("#newsie-timeline-event-dot-"+c).removeClass("newsie-timeline-event-dot-selected"),$("#newsie-timeline-event-dot-"+c).css("z-index","1"),$("#newsie-timeline-label-"+c).css("visibility","hidden")):a>=scrollVals[c]-b?(curPos=c,$("#newsie-timeline-event-dot-"+c).addClass("newsie-timeline-event-dot-selected"),$("#newsie-timeline-event-dot-"+c).css("z-index","10"),$("#newsie-timeline-label-"+c).css("visibility","visible")):($("#newsie-timeline-event-dot-"+c).removeClass("newsie-timeline-event-dot-selected"),$("#newsie-timeline-event-dot-"+c).css("z-index","1"),$("#newsie-timeline-label-"+c).css("visibility","hidden"))})}function resizeTimeline(){$("#timeline-events").css("width",.8*$("#newsie-line").width())}function drawFirstLastLabels(){var a=0,b=json.date.length-1;$("#first-newsie-timeline-label").text(month[dates[a].getMonth()]+" "+dates[a].getDate()+", "+dates[a].getFullYear()).css({position:"absolute",left:100*dateCoords[a]+"%"}),$("#last-newsie-timeline-label").text(month[dates[b].getMonth()]+" "+dates[b].getDate()+", "+dates[b].getFullYear()).css({position:"absolute",left:100*dateCoords[b]+"%"})}function createDOMFramework(){$("#newsie-timeline-container").append($("<div>").attr({id:"newsie-content"}).append($("<div>").attr({id:"newsie-line","class":"stickem"}).append($("<div>").attr({id:"line-container"}).append($("<div>").attr({id:"newsie-line-bg"})).append($("<ul>").attr({"class":"newsie-timeline-label",id:"newsie-timeline-labels"}).append($("<li>").attr({"class":"newsie-timeline-label",id:"first-newsie-timeline-label"})).append($("<li>").attr({"class":"newsie-timeline-label",id:"last-newsie-timeline-label"}))).append($("<ul>").attr({"class":"timeline",id:"timeline-events"})).append($("<div>").attr({id:"newsie-button-container"}).append($("<div>").attr({"class":"button",id:"newsie-back-button"}).html("<h4>Previous</h4>")).append($("<div>").attr({"class":"button",id:"newsie-forward-button"}).html("<h4>Next</h4>"))))))}var dfd=$.Deferred(),json=new Array,dates=new Array,dateCoords=new Array,scrollVals=new Array,curPos=-1,month=new Array;month[0]="Jan.",month[1]="Feb.",month[2]="Mar.",month[3]="Apr.",month[4]="May",month[5]="June",month[6]="July",month[7]="Aug.",month[8]="Sept.",month[9]="Oct.",month[10]="Nov.",month[11]="Dec.";var coord=function(a,b,c){return range=b-a,(c-a)/range};$(function(){var a=new Miso.Dataset({importer:Miso.Dataset.Importers.GoogleSpreadsheet,parser:Miso.Dataset.Parsers.GoogleSpreadsheet,key:$("#newsie-timeline-container").attr("gsKey"),worksheet:"1"});getDataset=function(){a.fetch({success:function(){json.date=a.column("Date").data,$.each(json.date,function(b,c){if(json.date[b]=new Date(c),null!=a.column("Time").data[b]){var d=parseTime(a.column("Time").data[b]);json.date[b].setHours(d[0]),json.date[b].setMinutes(d[1])}}),json.title=a.column("Title").data,json.content=a.column("Text").data,json.mediaURL=a.column("MediaURL").data,json.mediaCredit=a.column("MediaCredit").data,dfd.resolve()},error:function(){console.log("Are you sure you are connected to the internet?")}})},getDataset(),dfd.done(createDOMFramework,populateDivs,getCoords,drawTimeline,drawFirstLastLabels,function(){$("#newsie-timeline-container").addClass("newsie-container"),$("#newsie-content").addClass("stickem-container"),$("#newsie-timeline-container").imagesLoaded(function(){$(".newsie-container").stickem(),currentView(),$(window).scroll(function(){currentView()})})})});